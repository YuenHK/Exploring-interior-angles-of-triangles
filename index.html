<!doctype html>
<html lang="zh-TW" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>ä¸‰è§’å½¢å…§è§’æ¢ç´¢</title>
  <script src="https://cdn.tailwindcss.com/3.4.17"></script>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
  
  <style>
    body { 
        box-sizing: border-box; 
        font-family: 'Noto Sans TC', sans-serif; 
        touch-action: none; 
        -webkit-user-select: none;
        user-select: none;
        height: 100dvh; 
        overflow: hidden; 
    }
    
    .math-x { font-family: 'Times New Roman', serif; font-style: italic; }

    /* å¤–å±¤å…‰æšˆå‹•ç•« (ä¿æŒä¸è®Š) */
    @keyframes pulse-glow {
      0%, 100% { filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.5)); }
      50% { filter: drop-shadow(0 0 15px rgba(255, 255, 255, 0.8)); }
    }
    .walker-glow { animation: pulse-glow 2s ease-in-out infinite; }

    /* â˜…â˜…â˜… æ–°å¢ï¼šèµ°è·¯å‹•ç•« (ä¸Šä¸‹è·³å‹• + è¼•å¾®æ–æ“º) â˜…â˜…â˜… */
    @keyframes walk-anim {
      0%, 100% { transform: translateY(0) rotate(0deg); }
      25% { transform: translateY(-8px) rotate(5deg); }
      75% { transform: translateY(-8px) rotate(-5deg); }
    }
    .is-walking {
      animation: walk-anim 0.3s infinite ease-in-out;
    }

    /* â˜…â˜…â˜… æ–°å¢ï¼šè§€å¯Ÿå‹•ç•« (æ”¾å¤§ç¸®å° + å·¦å³å¼µæœ›) â˜…â˜…â˜… */
    @keyframes observe-anim {
      0%, 100% { transform: scale(1) rotate(0deg); }
      50% { transform: scale(1.15) rotate(0deg); } /* å‘¼å¸æ„Ÿ */
      25% { transform: scale(1.05) rotate(-10deg); } /* å·¦çœ‹ */
      75% { transform: scale(1.05) rotate(10deg); } /* å³çœ‹ */
    }
    .is-observing {
      animation: observe-anim 2s infinite ease-in-out;
    }
    
    .draggable-vertex {
      transition: r 0.2s, filter 0.2s;
      cursor: grab;
      vector-effect: non-scaling-stroke; 
    }
    .draggable-vertex:active {
      cursor: grabbing;
      r: 24; 
      filter: drop-shadow(0 0 8px rgba(255,255,255,0.8));
    }
    .hidden { display: none !important; }
    
    .fade-in-text { animation: fadeIn 0.5s ease-in; }
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(-5px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .angle-row { padding: 0.5rem 1rem; }
    
    /* ç¢ºä¿åœ–ç‰‡è®Šæ›æ™‚ä¸­å¿ƒé»æ­£ç¢º */
    #walker-img {
        transform-box: fill-box;
        transform-origin: center;
    }
  </style>
</head>
<body class="bg-slate-900 text-slate-100 flex flex-col">

  <div class="w-full h-full max-w-[1366px] mx-auto p-2 md:p-4 flex flex-col">
    
    <div class="text-center mb-2 flex-none">
      <h1 class="text-xl md:text-3xl font-bold mb-1 text-amber-400">ğŸ“ ä¸‰è§’å½¢å…§è§’å¤§ç™¼ç¾</h1>
    </div>

   <div class="flex flex-col md:flex-row gap-3 md:gap-6 flex-none min-h-0 items-stretch">
      
      <div class="w-full md:w-72 lg:w-80 flex flex-col gap-2 order-2 md:order-1 flex-none">
        
       <div class="bg-slate-800 rounded-2xl p-4 border border-slate-700 shadow-lg">
          <h3 class="text-amber-400 font-bold mb-2">ğŸ“ è§€å¯Ÿå“¡ MISS WONG ç‹€æ…‹<div class="flex justify-center">
  <img src='https://i.imgur.com/xR6lY2Y.png' width='80' height='80' alt="Centered image">
</div></h3>
          <p id="status-text" class="text-slate-300 text-sm">è«‹æ‹–æ›³ç´…é» A å¸¶æˆ‘ç§»å‹•ã€‚</p>
        </div>
        <div class="bg-slate-800 rounded-2xl p-3 border border-slate-700 shadow-lg flex-1 flex flex-col justify-center min-h-0 overflow-y-auto">
          <h3 class="text-blue-400 font-bold mb-2 text-xl text-center">ğŸ“ è§’åº¦è¨˜éŒ„</h3>
          
          <div class="space-y-2 flex-1 flex flex-col justify-center">
            <div class="angle-row flex justify-between items-center rounded bg-slate-700/50 border-l-8 border-red-500 h-14">
              <span class="text-red-400 font-bold text-xl">âˆ A</span>
              <span id="record-a" class="font-mono text-3xl transition-all duration-300">--</span>
            </div>

            <div class="angle-row flex justify-between items-center rounded bg-slate-700/50 border-l-8 border-blue-500 h-14">
              <span class="text-blue-400 font-bold text-xl">âˆ B</span>
              <span id="record-b" class="font-mono text-3xl transition-all duration-300">--</span>
            </div>

            <div class="angle-row flex justify-between items-center rounded bg-slate-700/50 border-l-8 border-green-500 h-14 relative">
              <span class="text-green-400 font-bold text-xl">âˆ C</span>
              <span id="record-c" class="font-mono text-3xl transition-all duration-300">--</span>
            </div>

            <div class="border-t-2 border-slate-600 pt-2 mt-1 px-2">
              <div class="flex justify-between items-end mb-1">
                <span class="text-amber-400 font-bold text-lg">å…§è§’å’Œ</span>
                <span id="total-formula" class="text-slate-400 text-xs font-mono text-right"></span>
              </div>
              <div class="text-right">
                <span id="record-total" class="font-mono text-3xl text-amber-400 font-bold">0Â°</span>
              </div>
            </div>
          </div>

          <div id="quiz-hint" class="hidden mt-2 text-sm text-center text-slate-400 bg-slate-900/50 p-2 rounded-lg">
            æç¤ºï¼š180 - A - B = <span class="math-x text-lg">x</span>
          </div>
        </div>
      </div>

      <div class="flex-1 order-1 md:order-2 bg-slate-800 rounded-3xl border border-slate-700 shadow-2xl relative overflow-hidden max-h-[60vh]" style="touch-action: none;">
        <svg id="triangle-svg" viewBox="0 0 500 400" preserveAspectRatio="xMidYMid meet" class="w-full h-full select-none" style="touch-action: none;">
          <defs>
            <pattern id="grid" width="20" height="20" patternUnits="userSpaceOnUse">
              <path d="M 20 0 L 0 0 0 20" fill="none" stroke="rgba(255,255,255,0.05)" stroke-width="1"/>
            </pattern>
            <clipPath id="circle-clip">
              <circle cx="0" cy="0" r="20" />
            </clipPath>
          </defs>

          <rect width="500" height="400" fill="url(#grid)" />

          <g id="proof-area" transform="translate(250, 380)" opacity="0">
             <line x1="-100" y1="0" x2="100" y2="0" stroke="#64748b" stroke-width="2" stroke-dasharray="5,5" />
             <text x="0" y="18" text-anchor="middle" fill="#94a3b8" font-size="12">å¹³è§’ (180Â°)</text>
          </g>

          <polygon id="triangle-path" points="0,0 0,0 0,0" fill="rgba(30, 41, 59, 0.5)" stroke="#94a3b8" stroke-width="4" stroke-linejoin="round" />
          <g id="angle-arcs"></g>

          <circle id="vertex-a" r="18" fill="#ef4444" stroke="white" stroke-width="3" class="draggable-vertex" />
          <circle id="vertex-b" r="18" fill="#3b82f6" stroke="white" stroke-width="3" class="draggable-vertex" />
          <circle id="vertex-c" r="18" fill="#22c55e" stroke="white" stroke-width="3" class="draggable-vertex" />

          <text id="label-a" fill="#ef4444" font-weight="bold" font-size="20" text-anchor="middle" pointer-events="none">A</text>
          <text id="label-b" fill="#3b82f6" font-weight="bold" font-size="20" text-anchor="start" pointer-events="none">B</text>
          <text id="label-c" fill="#22c55e" font-weight="bold" font-size="20" text-anchor="end" pointer-events="none">C</text>

          <g id="walker" transform="translate(0,0)" class="walker-glow" pointer-events="none" style="transition: transform 1.0s linear;">
            <circle cx="0" cy="0" r="23" fill="white" />
            <image 
              id="walker-img"
              href="https://i.imgur.com/xR6lY2Y.png" 
              x="-20" y="-20" width="40" height="40" 
              clip-path="url(#circle-clip)"
              preserveAspectRatio="xMidYMid slice"
              class="is-observing" 
            />
          </g>
        </svg>

        <div id="discovery-msg" class="hidden absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-slate-900/95 backdrop-blur border-4 border-amber-400 p-6 rounded-3xl text-center shadow-2xl w-4/5 max-w-md z-50">
          <h2 class="text-2xl md:text-3xl font-bold text-amber-400 mb-4">ğŸ‰ ç™¼ç¾å®šç†ï¼</h2>
          <p class="text-white mb-6 text-lg">ä¸ç®¡æ€éº¼è®Šå½¢ï¼Œä¸‰å€‹è§’åŠ èµ·ä¾†æ°¸é æ˜¯ <span class="text-amber-300 font-bold">180Â°</span>ï¼</p>
          <button onclick="closeDiscovery()" class="px-8 py-3 bg-amber-500 hover:bg-amber-600 text-slate-900 font-bold text-lg rounded-full transition shadow-lg">å¤ªæ£’äº†</button>
        </div>
      </div>
    </div>

<div class="mt-2 md:mt-4 mb-10 flex flex-wrap justify-center gap-2 md:gap-4 flex-none pb-safe">
      <button id="quiz-btn" class="px-6 py-3 bg-purple-600 hover:bg-purple-500 text-white rounded-xl font-bold text-base md:text-lg shadow-lg flex items-center gap-2 transition-all active:scale-95 touch-manipulation">
        <span>â“</span> Hide Answer
      </button>
      
      <div class="w-px h-10 bg-slate-700 mx-1 hidden md:block"></div>
      
      <button id="prev-btn" class="px-6 py-3 bg-slate-700 hover:bg-slate-600 text-slate-300 rounded-xl font-medium text-base md:text-lg transition-all disabled:opacity-50 touch-manipulation">â—€ ä¸Šä¸€æ­¥</button>
      <button id="next-btn" class="px-8 py-3 bg-amber-500 hover:bg-amber-400 text-slate-900 rounded-xl font-bold text-base md:text-lg shadow-lg flex items-center gap-2 transition-all active:scale-95 touch-manipulation">ä¸‹ä¸€æ­¥ â–¶</button>
      <button id="reset-btn" class="px-6 py-3 bg-slate-700 hover:bg-slate-600 text-white rounded-xl font-medium text-base md:text-lg transition-all touch-manipulation">â†º é‡ç½®</button>
    </div>

  </div>

  <script>
    const colors = { A: '#ef4444', B: '#3b82f6', C: '#22c55e' };
    let vertices = {
      A: { x: 250, y: 80 },
      B: { x: 400, y: 320 },
      C: { x: 100, y: 320 }
    };
    
    const states = [
      { step: 0, target: 'A', msg: 'å¾é ‚é» A (ç´…è‰²) é–‹å§‹ã€‚' },
      { step: 1, target: 'A', action: 'showAngle', msg: 'è§€å¯Ÿ A çš„å…§è§’ã€‚' },
      { step: 2, target: 'B', msg: 'ç§»å‹•åˆ°é ‚é» B...' },
      { step: 3, target: 'B', action: 'showAngle', msg: 'è§€å¯Ÿ B çš„å…§è§’ã€‚' },
      { step: 4, target: 'C', msg: 'ç§»å‹•åˆ°é ‚é» C...' },
      { step: 5, target: 'C', action: 'showAngle', msg: 'è§€å¯Ÿ C çš„å…§è§’ã€‚' },
      { step: 6, target: 'A', msg: 'å›åˆ°èµ·é» Aã€‚' },
      { step: 7, target: 'A', action: 'proof', msg: 'è¦‹è­‰ 180 åº¦å®šç†ï¼' }
    ];

    let currentStep = 0;
    let isQuizMode = false;
    let isDragging = false;
    let draggedVertex = null;
    let computedAngles = { A: 0, B: 0, C: 0 };
    
    // å‹•ç•«è¨ˆæ™‚å™¨
    let walkTimeout = null;

    const svg = document.getElementById('triangle-svg');
    const walker = document.getElementById('walker');
    const walkerImg = document.getElementById('walker-img'); // â˜… å–å¾—åœ–ç‰‡å…ƒç´ 
    const angleArcsGroup = document.getElementById('angle-arcs');
    const proofArea = document.getElementById('proof-area');
    const statusText = document.getElementById('status-text');
    const quizBtn = document.getElementById('quiz-btn');

    function calculateAngles() {
      const getRawAngle = (p1, p2, p3) => {
        const v1 = { x: p1.x - p2.x, y: p1.y - p2.y };
        const v2 = { x: p3.x - p2.x, y: p3.y - p2.y };
        const dot = v1.x * v2.x + v1.y * v2.y;
        const mag1 = Math.sqrt(v1.x**2 + v1.y**2);
        const mag2 = Math.sqrt(v2.x**2 + v2.y**2);
        return Math.acos(Math.max(-1, Math.min(1, dot / (mag1 * mag2)))) * (180 / Math.PI);
      };
      const rawA = getRawAngle(vertices.B, vertices.A, vertices.C);
      const rawB = getRawAngle(vertices.A, vertices.B, vertices.C);
      computedAngles.A = Math.round(rawA);
      computedAngles.B = Math.round(rawB);
      computedAngles.C = 180 - computedAngles.A - computedAngles.B;
      if (computedAngles.C <= 0) { computedAngles.C = 1; computedAngles.A -= 1; }
    }

    function render() {
      calculateAngles();
      const pathStr = `${vertices.A.x},${vertices.A.y} ${vertices.B.x},${vertices.B.y} ${vertices.C.x},${vertices.C.y}`;
      document.getElementById('triangle-path').setAttribute('points', pathStr);
      ['A', 'B', 'C'].forEach(v => {
        const circle = document.getElementById(`vertex-${v.toLowerCase()}`);
        circle.setAttribute('cx', vertices[v].x);
        circle.setAttribute('cy', vertices[v].y);
        const label = document.getElementById(`label-${v.toLowerCase()}`);
        const offsetX = v === 'A' ? 0 : (v === 'B' ? 25 : -25);
        const offsetY = v === 'A' ? -30 : 30;
        label.setAttribute('x', vertices[v].x + offsetX);
        label.setAttribute('y', vertices[v].y + offsetY);
      });
      if (isDragging && draggedVertex === 'A') {
         walker.style.transition = 'none';
         walker.setAttribute('transform', `translate(${vertices.A.x}, ${vertices.A.y})`);
         // æ‹–æ›³æ™‚å¼·åˆ¶è¨­ç‚ºè§€å¯Ÿæ¨¡å¼ï¼Œæ¯”è¼ƒä¸æšˆ
         walkerImg.classList.remove('is-walking');
         walkerImg.classList.add('is-observing');
      }
      updatePanel();
      renderCurrentStepVisuals();
    }

    function updatePanel() {
      const elA = document.getElementById('record-a');
      const elB = document.getElementById('record-b');
      const elC = document.getElementById('record-c');
      const elTotal = document.getElementById('record-total');
      const elFormula = document.getElementById('total-formula');
      const hint = document.getElementById('quiz-hint');

      const stepReachedA = currentStep >= 1 || currentStep >= 7;
      const stepReachedB = currentStep >= 3 || currentStep >= 7;
      const stepReachedC = currentStep >= 5 || currentStep >= 7;

      if (isQuizMode) {
          elA.textContent = `${computedAngles.A}Â°`;
          elA.className = "font-mono text-3xl md:text-4xl text-white fade-in-text";
          
          elB.textContent = `${computedAngles.B}Â°`;
          elB.className = "font-mono text-3xl md:text-4xl text-white fade-in-text";
          
          elC.innerHTML = '<span class="math-x text-3xl md:text-4xl text-red-400">x</span>';
          elC.className = "fade-in-text";
          
          elFormula.innerHTML = "";
          elTotal.textContent = "180Â°";
          hint.classList.remove('hidden');
      } else {
          elA.textContent = stepReachedA ? `${computedAngles.A}Â°` : "--";
          elA.className = stepReachedA ? "font-mono text-3xl md:text-4xl text-white fade-in-text" : "font-mono text-3xl md:text-4xl text-slate-500";

          elB.textContent = stepReachedB ? `${computedAngles.B}Â°` : "--";
          elB.className = stepReachedB ? "font-mono text-3xl md:text-4xl text-white fade-in-text" : "font-mono text-3xl md:text-4xl text-slate-500";

          elC.textContent = stepReachedC ? `${computedAngles.C}Â°` : "--";
          elC.className = stepReachedC ? "font-mono text-3xl md:text-4xl text-white fade-in-text" : "font-mono text-3xl md:text-4xl text-slate-500";
          
         if (stepReachedC) {
              // å…¨éƒ¨é¡¯ç¤º
              elFormula.innerHTML = `âˆ A + âˆ B + âˆ C =${computedAngles.A}Â° + ${computedAngles.B}Â° + ${computedAngles.C}Â° =`;
              elTotal.textContent = "180Â°";
          } else if (stepReachedB) {
              // é¡¯ç¤º A + B
              const sumAB = computedAngles.A + computedAngles.B;
              // ç®—å¼ï¼šâˆ A + âˆ B = 60 + 40 = 
              elFormula.innerHTML = `âˆ A + âˆ B = ${computedAngles.A}Â° + ${computedAngles.B}Â° =`;
              elTotal.textContent = `${sumAB}Â°`;
          } else if (stepReachedA) {
              elFormula.innerHTML = "âˆ A =";
              elTotal.textContent = `${computedAngles.A}Â°`;
          } else {
              elFormula.innerHTML = "";
              elTotal.textContent = "0Â°";
          }
          hint.classList.add('hidden');
      }
    }

    function createArc(vertexKey, cx, cy, startVertex, endVertex) {
        const radius = 40;
        const color = colors[vertexKey];
        const angleVal = computedAngles[vertexKey];
        const rad1 = Math.atan2(startVertex.y - cy, startVertex.x - cx);
        const rad2 = Math.atan2(endVertex.y - cy, endVertex.x - cx);
        let startAngle = rad1;
        let endAngle = rad2;
        let diff = endAngle - startAngle;
        while (diff <= -Math.PI) diff += 2 * Math.PI;
        while (diff > Math.PI) diff -= 2 * Math.PI;
        if (diff < 0) [startAngle, endAngle] = [endAngle, startAngle];

        const x1 = cx + radius * Math.cos(startAngle);
        const y1 = cy + radius * Math.sin(startAngle);
        const x2 = cx + radius * Math.cos(endAngle);
        const y2 = cy + radius * Math.sin(endAngle);
        const largeArc = Math.abs(diff) > Math.PI ? 1 : 0;
        
        const g = document.createElementNS("http://www.w3.org/2000/svg", "g");
        const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
        path.setAttribute("d", `M ${cx} ${cy} L ${x1} ${y1} A ${radius} ${radius} 0 ${largeArc} 1 ${x2} ${y2} Z`);
        path.setAttribute("fill", color);
        path.setAttribute("fill-opacity", "0.3");
        path.setAttribute("stroke", color);
        path.setAttribute("stroke-width", "2");
        g.appendChild(path);

        let midAngle = (startAngle + endAngle) / 2;
        if (Math.abs(endAngle - startAngle) > Math.PI) midAngle += Math.PI;
        const textDist = 60;
        const textX = cx + textDist * Math.cos(midAngle);
        const textY = cy + textDist * Math.sin(midAngle);
        const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
        text.setAttribute("x", textX);
        text.setAttribute("y", textY);
        text.setAttribute("text-anchor", "middle");
        text.setAttribute("dominant-baseline", "middle");
        text.style.textShadow = "0px 2px 4px rgba(0,0,0,0.8)";
        
        if (isQuizMode) {
            if (vertexKey === 'C') {
                text.textContent = "x";
                text.setAttribute("fill", "#f87171"); 
                text.setAttribute("font-size", "28");
                text.setAttribute("font-family", "'Times New Roman', serif");
                text.setAttribute("font-style", "italic");
                text.setAttribute("font-weight", "bold");
            } else {
                text.textContent = `${angleVal}Â°`;
                text.setAttribute("fill", "white");
                text.setAttribute("font-size", "16");
                text.setAttribute("font-weight", "bold");
            }
        } else {
            text.textContent = `${angleVal}Â°`;
            text.setAttribute("fill", "white");
            text.setAttribute("font-size", "16");
            text.setAttribute("font-weight", "bold");
        }
        g.appendChild(text);
        return g;
    }

    function renderCurrentStepVisuals() {
        angleArcsGroup.innerHTML = '';
        proofArea.style.opacity = '0';
        const s = states[currentStep];
        const stepReachedA = currentStep >= 1;
        const stepReachedB = currentStep >= 3;
        const stepReachedC = currentStep >= 5;
        const showA = isQuizMode || stepReachedA;
        const showB = isQuizMode || stepReachedB;
        const showC = isQuizMode || stepReachedC;

        if (showA) angleArcsGroup.appendChild(createArc('A', vertices.A.x, vertices.A.y, vertices.B, vertices.C));
        if (showB) angleArcsGroup.appendChild(createArc('B', vertices.B.x, vertices.B.y, vertices.C, vertices.A));
        if (showC) angleArcsGroup.appendChild(createArc('C', vertices.C.x, vertices.C.y, vertices.A, vertices.B));

        if (s.action === 'proof') { showVisualProof(); }
    }

    function goToStep(index) {
        currentStep = index;
        const s = states[currentStep];
        statusText.textContent = s.msg;
        const targetPos = vertices[s.target];
        
        walker.style.transition = 'transform 1.0s linear';
        walker.setAttribute('transform', `translate(${targetPos.x}, ${targetPos.y})`);
        
        // â˜…â˜…â˜… å‹•ç•«åˆ‡æ›é‚è¼¯ â˜…â˜…â˜…
        // 1. æ¸…é™¤ä¹‹å‰çš„è¨ˆæ™‚å™¨ï¼ˆå¦‚æœæœ‰çš„è©±ï¼‰
        if (walkTimeout) clearTimeout(walkTimeout);
        
        // 2. åˆ‡æ›åˆ°ã€Œèµ°å‹•ã€ç‹€æ…‹
        walkerImg.classList.remove('is-observing');
        walkerImg.classList.add('is-walking');
        
        // 3. è¨­å®šè¨ˆæ™‚å™¨ï¼Œ1ç§’å¾Œï¼ˆç§»å‹•çµæŸï¼‰åˆ‡æ›å›ã€Œè§€å¯Ÿã€ç‹€æ…‹
        walkTimeout = setTimeout(() => {
            walkerImg.classList.remove('is-walking');
            walkerImg.classList.add('is-observing');
        }, 1000); // é€™è£¡çš„ 1000ms å°æ‡‰ CSS transition çš„æ™‚é–“

        renderCurrentStepVisuals();
        updatePanel();
        
        document.getElementById('prev-btn').disabled = (index === 0);
        const nextBtn = document.getElementById('next-btn');
        if (index === states.length - 1) {
            nextBtn.innerHTML = 'ğŸ‰ å®Œæˆ';
            document.getElementById('discovery-msg').classList.remove('hidden');
        } else {
            nextBtn.innerHTML = 'ä¸‹ä¸€æ­¥ â–¶';
            document.getElementById('discovery-msg').classList.add('hidden');
        }
    }

    function showVisualProof() {
        proofArea.style.opacity = '1';
        const r = 50;
        const startB = 180;
        const endB = 180 + computedAngles.B;
        createWedge(0, 0, r, startB, endB, colors.B);
        const startA = endB;
        const endA = startA + computedAngles.A;
        createWedge(0, 0, r, startA, endA, colors.A);
        const startC = endA;
        const endC = 360; 
        createWedge(0, 0, r, startC, endC, colors.C, isQuizMode);
    }

    function createWedge(cx, cy, r, startDeg, endDeg, color, isHidden = false) {
        const rad1 = startDeg * Math.PI / 180;
        const rad2 = endDeg * Math.PI / 180;
        const x1 = cx + r * Math.cos(rad1);
        const y1 = cy + r * Math.sin(rad1);
        const x2 = cx + r * Math.cos(rad2);
        const y2 = cy + r * Math.sin(rad2);
        const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
        path.setAttribute("d", `M ${cx} ${cy} L ${x1} ${y1} A ${r} ${r} 0 0 1 ${x2} ${y2} Z`);
        path.setAttribute("fill", color);
        path.setAttribute("stroke", "white");
        path.setAttribute("stroke-width", "1");
        path.style.transformOrigin = "0px 0px";
        path.style.transform = "scale(0)";
        path.style.transition = "transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275)";
        proofArea.appendChild(path);
        
        if (isHidden) {
             const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
             const midRad = (rad1 + rad2) / 2;
             text.setAttribute("x", cx + (r+25) * Math.cos(midRad));
             text.setAttribute("y", cy + (r+25) * Math.sin(midRad));
             text.textContent = "x";
             text.setAttribute("fill", color);
             text.setAttribute("font-size", "20");
             text.setAttribute("font-family", "'Times New Roman', serif");
             text.setAttribute("font-style", "italic");
             text.setAttribute("font-weight", "bold");
             text.setAttribute("text-anchor", "middle");
             text.style.opacity = "0";
             text.style.transition = "opacity 0.5s 0.5s";
             proofArea.appendChild(text);
             setTimeout(() => text.style.opacity = "1", 100);
        }
        setTimeout(() => path.style.transform = "scale(1)", 100);
    }

    function getEventPoint(e) {
        if (e.touches && e.touches.length > 0) {
            return { x: e.touches[0].clientX, y: e.touches[0].clientY };
        } else if (e.changedTouches && e.changedTouches.length > 0) {
            return { x: e.changedTouches[0].clientX, y: e.changedTouches[0].clientY };
        }
        return { x: e.clientX, y: e.clientY };
    }

    function handleStart(e) {
      if (e.target.classList.contains('draggable-vertex')) {
        if (e.type === 'touchstart') e.preventDefault();
        isDragging = true;
        draggedVertex = e.target.id.split('-')[1].toUpperCase();
      }
    }

    function handleMove(e) {
      if (!isDragging) return;
      e.preventDefault(); 
      const point = getEventPoint(e);
      const pt = svg.createSVGPoint();
      pt.x = point.x;
      pt.y = point.y;
      const svgP = pt.matrixTransform(svg.getScreenCTM().inverse());
      const x = Math.max(20, Math.min(480, svgP.x));
      const y = Math.max(20, Math.min(430, svgP.y));
      vertices[draggedVertex] = { x, y };
      if (currentStep === 7) { closeDiscovery(); goToStep(0); }
      render();
    }

    function handleEnd(e) { isDragging = false; draggedVertex = null; }

    svg.addEventListener('mousedown', handleStart);
    window.addEventListener('mousemove', handleMove);
    window.addEventListener('mouseup', handleEnd);
    svg.addEventListener('touchstart', handleStart, { passive: false });
    window.addEventListener('touchmove', handleMove, { passive: false });
    window.addEventListener('touchend', handleEnd);

    document.getElementById('next-btn').addEventListener('click', () => { if (currentStep < states.length - 1) goToStep(currentStep + 1); });
    document.getElementById('prev-btn').addEventListener('click', () => { if (currentStep > 0) goToStep(currentStep - 1); });
    document.getElementById('reset-btn').addEventListener('click', () => {
      vertices = { A: { x: 250, y: 80 }, B: { x: 400, y: 320 }, C: { x: 100, y: 320 } };
      closeDiscovery();
      goToStep(0);
      render();
    });

    quizBtn.addEventListener('click', () => {
      isQuizMode = !isQuizMode;
      if (isQuizMode) {
          quizBtn.classList.replace('bg-purple-600', 'bg-red-500');
          quizBtn.classList.replace('hover:bg-purple-500', 'hover:bg-red-400');
          quizBtn.innerHTML = '<span>ğŸ‘ï¸</span> Show Answer';
      } else {
          quizBtn.classList.replace('bg-red-500', 'bg-purple-600');
          quizBtn.classList.replace('hover:bg-red-400', 'hover:bg-purple-500');
          quizBtn.innerHTML = '<span>â“</span> Hide Answer';
      }
      render();
    });

    function closeDiscovery() { document.getElementById('discovery-msg').classList.add('hidden'); }
    render();
    goToStep(0);
  </script>
</body>
</html>